# 手順書解析ツール 使用ガイド

## 概要

このツールは特定のフォーマットで書かれた手順書（Markdown形式）を解析し、記載されたファイル操作（新規作成・修正・削除）を自動的に実行するPythonスクリプトです。また、実行コマンドをスクリプトファイルとして生成し、Git操作も自動化します。

## 基本的な使用方法

```bash
python procedure_parser.py <手順書ファイルパス> <出力ディレクトリ>
```

## 必要な環境

- Python 3.6以上
- Git（Git操作を行う場合）

## 手順書フォーマット要件

手順書は以下の形式に従う必要があります：

1. 冒頭に「準拠手順書形式：v1.0.0」の記載が必要
2. 以下のセクションが必須：
   - `# <アプリ名>`（タイトル）
   - `## 概要`
   - `## アプリ実行コマンド`（```bash〜```で囲まれたコマンド）
   - `## 必要ファイル一覧`
   - `## ファイルの中身`
   - `## 備考`

3. ファイル一覧は「アクション,ファイルID,ファイルパス」の形式（例：`新規,00001,src/main.py`）
4. アクションは「新規」「修正」「削除」のいずれか
5. ファイルIDは5桁の数字

## エラーが発生する条件

### 基本的なエラー

1. **引数不足**：スクリプト実行時に手順書ファイルパスと出力ディレクトリを指定しない場合
2. **ファイルアクセスエラー**：手順書ファイルが存在しない、または読み取り権限がない場合
3. **出力ディレクトリアクセスエラー**：出力ディレクトリに書き込み権限がない場合

### 手順書フォーマットエラー

1. **バージョン不一致**：手順書の準拠形式バージョンとスクリプトのバージョンが一致しない場合（警告が表示され、続行の確認が求められる）
2. **必須セクション欠落**：必須セクション（概要、アプリ実行コマンド、必要ファイル一覧、ファイルの中身、備考）が欠けている場合
3. **ファイル一覧フォーマット不正**：ファイル一覧の形式が「アクション,ファイルID,ファイルパス」に従っていない行がある場合
4. **ファイルID重複**：同じファイルIDが複数回使用されている場合

### コード管理番号関連エラー

1. **新規ファイルのコード管理番号欠落**：新規ファイルにコード管理番号（`// #00001`など）が含まれていない場合
2. **コード管理番号の重複**：同一ファイル内で同じコード管理番号が複数回使用されている場合
3. **修正区間のコード管理番号欠落**：修正区間内にコード管理番号が記載されていない場合
4. **修正区間の開始・終了コード欠落**：修正区間に開始または終了のコード管理番号が含まれていない場合

### ファイル操作関連エラー

1. **ファイル作成・修正失敗**：ファイルの作成や修正が失敗する場合（権限問題、ディスク容量不足など）
2. **修正対象ファイル不在**：修正対象のファイルが存在しない場合（警告が表示され処理は続行）
3. **削除対象ファイル不在**：削除対象のファイルが存在しない場合（警告が表示され処理は続行）
4. **コード管理番号不在**：ファイル内でコード管理番号が見つからない場合（修正時）

### Git操作関連エラー

1. **Git初期化エラー**：出力ディレクトリがGitリポジトリでない、または`.git`ディレクトリにアクセスできない場合
2. **Gitコマンド実行エラー**：`git add`や`git commit`コマンドの実行が失敗する場合
3. **コミットするファイルなし**：ファイルリストが空の場合

## 手順書の作成例

```markdown
# サンプルアプリケーション
準拠手順書形式：v1.0.0

## 概要
これはサンプルアプリケーションです。

## アプリ実行コマンド
```bash
cd app
python main.py
```

## 必要ファイル一覧
新規,00001,app/main.py
新規,00002,app/config.py
修正,00003,app/utils.py

## ファイルの中身

### 新規,00001,app/main.py
```python
#!/usr/bin/env python
# #00001
import sys
from config import CONFIG

def main():
    print("Hello, World!")
    print(f"Config: {CONFIG}")
    return 0

if __name__ == "__main__":
    sys.exit(main())
```

### 新規,00002,app/config.py
コミット内容：設定ファイルの追加
```python
# #00002
CONFIG = {
    "version": "1.0.0",
    "name": "sample"
}
```

### 修正,00003,app/utils.py
#### #00004-#00005
```python
# #00004
def helper_function():
    """ヘルパー関数"""
    return "This is a helper function"
# #00005
```

## 備考
これはサンプル手順書です。
```

## トラブルシューティング

1. **バージョン不一致エラー**：
   手順書のバージョン（`準拠手順書形式：vX.X.X`）とスクリプトのバージョン（`VERSION = "X.X.X"`）を一致させてください。

2. **コード管理番号が見つからない**：
   すべてのファイルおよび修正区間に適切なコード管理番号（`// #00001`、`# #00002`など）が含まれていることを確認してください。
   言語に応じた適切なコメント記号（`//`、`#`、`/*`、`<!--`）を使用してください。

3. **修正がうまく適用されない**：
   - コード管理番号の前後に余計な文字がないか確認
   - 修正区間の開始コードと終了コードが正しく指定されているか確認
   - 修正内容にも適切なコード管理番号が含まれているか確認

4. **Git操作エラー**：
   - 出力ディレクトリがGitリポジトリであることを確認
   - 適切なGit設定（ユーザー名、メールアドレス）が行われていることを確認

## 注意事項

1. コード管理番号はファイル内で一意である必要があります
2. 修正対象ファイルは事前に存在している必要があります
3. 修正区間は他の修正区間と重複しないようにしてください
4. バックアップが作成されますが、重要なファイルは事前にバックアップしておくことをお勧めします
